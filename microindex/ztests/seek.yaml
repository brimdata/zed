# create a zng with sos every two records then index it as a time index
script: |
  zq -b 2 - | microindex seek -f 100 -o index.zng -k ts -
  zq -z index.zng

inputs:
  - name: stdin
    data: |
      {ts:1970-01-01T00:16:40Z,foo:"a"}
      {ts:1970-01-01T00:16:41Z,foo:"b"}
      {ts:1970-01-01T00:16:42Z,foo:"c"}
      {ts:1970-01-01T00:16:43Z,foo:"d"}
      {ts:1970-01-01T00:16:44Z,foo:"e"}
      {ts:1970-01-01T00:16:45Z,foo:"f"}
      {ts:1970-01-01T00:16:46Z,foo:"g"}
      {ts:1970-01-01T00:16:47Z,foo:"h"}

outputs:
  - name: stdout
    data: |
      {ts:1970-01-01T00:16:40Z,offset:0}
      {ts:1970-01-01T00:16:42Z,offset:34}
      {ts:1970-01-01T00:16:44Z,offset:68}
      {ts:1970-01-01T00:16:46Z,offset:102}
      {magic:"microindex",version:2 (int32),descending:false,child_field:"_child",frame_thresh:100 (int32),sections:[58],keys:null (0=({ts:time}))} (=1)
