script: |
  source recruiter-curl.sh
  curl -X POST -d '{"addr":"a.b.c:5000","node_name":"a.b"}' \
    http://$ZQD_HOST/recruiter/register 2> err
  curl http://$ZQD_HOST/recruiter/stats 2> err
  curl http://$ZQD_HOST/recruiter/listfree 2> err
  curl -X POST -d '{"number_requested":1}' http://$ZQD_HOST/recruiter/recruit 2> err
  curl -request GET http://$ZQD_HOST/recruiter/stats 2> err
  # For the second register, the worker will be in the reserved pool,
  # so it will not be reregistered.
  curl -X POST -d '{"addr":"a.b.c:5000","node_name":"a.b"}' \
    http://$ZQD_HOST/recruiter/register 2> err
  curl -X POST -d '{"addrs":["a.b.c:5000"]}' \
    http://$ZQD_HOST/recruiter/unreserve 2> err
  curl -X POST -d '{"addr":"a.b.c:5000","node_name":"a.b"}' \
    http://$ZQD_HOST/recruiter/register 2> err
  curl -X POST -d '{"addr":"a.b.c:5000"}' \
    http://$ZQD_HOST/recruiter/deregister 2> err
  curl -X POST -d '{"number_requested":1}' http://$ZQD_HOST/recruiter/recruit 2> err

inputs:
  - name: recruiter-curl.sh
    source: recruiter-curl.sh

outputs:
  - name: stdout
    data: |
      {"registered":true}
      {"len_free_pool":1,"len_reserved_pool":0,"len_node_pool":1}
      {
        "workers": [
          {
            "addr": "a.b.c:5000",
            "node_name": "a.b"
          }
        ]
      }
      {"workers":[{"addr":"a.b.c:5000","node_name":"a.b"}]}
      {"len_free_pool":0,"len_reserved_pool":1,"len_node_pool":0}
      {"registered":false}
      {"reserved":false}
      {"registered":true}
      {"registered":false}
      {"workers":[]}
