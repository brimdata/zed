script: |
  source services.sh
  zapi -service $ZQD_HOST -s testsp postpcap -f ng.pcap >/dev/null
  zapi -service $ZQD_HOST -s testsp get -z "_path != stats | drop uid,geo | sort -r ts, _path"
  echo ===
  zapi -service $ZQD_HOST -s testsp get -z "count()"

inputs:
  - name: ng.pcap
    source: ../../../../pcap/ztests/ng.pcap
  - name: services.sh
    source: ../services.sh

outputs:
  - name: stdout
    data: |
      {_path:"capture_loss",ts:2015-03-05T15:21:33.736974Z,ts_delta:1.192ms,peer:"zeek" (bstring),gaps:0 (uint64),acks:0 (uint64),percent_lost:0.} (=0)
      {_path:"conn",ts:2015-03-05T15:21:33.735782Z,id:{orig_h:192.168.0.2,orig_p:34446 (port=(uint16)),resp_h:130.236.100.79,resp_p:80 (port)} (=1),proto:"tcp" (=zenum),service:null (bstring),duration:1.192ms,orig_bytes:0 (uint64),resp_bytes:2776 (uint64),conn_state:"OTH" (bstring),local_orig:null (bool),local_resp:null (bool),missed_bytes:0 (uint64),history:"Ad" (bstring),orig_pkts:1 (uint64),orig_ip_bytes:52 (uint64),resp_pkts:2 (uint64),resp_ip_bytes:2880 (uint64),tunnel_parents:null (2=(|[bstring]|)),community_id:"1:tOxXSQENCvoWlZaDPdf9YgwpshQ=" (bstring)} (=3)
      {_path:"capture_loss",ts:2015-03-05T15:21:33.735782Z,ts_delta:24m20.943301s,peer:"zeek",gaps:0,acks:0,percent_lost:0.} (0)
      {_path:"conn",ts:2015-03-05T14:57:12.792481Z,id:{orig_h:192.168.0.51,orig_p:50858,resp_h:192.168.0.1,resp_p:80},proto:"tcp",service:null,duration:740us,orig_bytes:338,resp_bytes:0,conn_state:"OTH",local_orig:null,local_resp:null,missed_bytes:0,history:"ADa",orig_pkts:2,orig_ip_bytes:418,resp_pkts:1,resp_ip_bytes:40,tunnel_parents:null,community_id:"1:YrhsMQd8siqxEOoc6A5E/gKZDgY="} (3)
      {_path:"conn",ts:2015-03-05T14:50:47.804914Z,id:{orig_h:192.168.0.51,orig_p:33773,resp_h:80.239.174.91,resp_p:443},proto:"tcp",service:null,duration:null,orig_bytes:null,resp_bytes:null,conn_state:"OTH",local_orig:null,local_resp:null,missed_bytes:0,history:"^d",orig_pkts:0,orig_ip_bytes:0,resp_pkts:1,resp_ip_bytes:1440,tunnel_parents:null,community_id:"1:wPP6HnEPl0F9QDVCQ+E0du2PUi8="} (3)
      {_path:"conn",ts:2015-03-05T14:50:47.804906Z,id:{orig_h:192.168.0.51,orig_p:33773,resp_h:80.239.174.91,resp_p:443},proto:"tcp",service:null,duration:null,orig_bytes:null,resp_bytes:null,conn_state:"OTH",local_orig:null,local_resp:null,missed_bytes:0,history:"^d",orig_pkts:0,orig_ip_bytes:0,resp_pkts:1,resp_ip_bytes:1440,tunnel_parents:null,community_id:"1:wPP6HnEPl0F9QDVCQ+E0du2PUi8="} (3)
      {_path:"conn",ts:2015-03-05T14:50:47.803929Z,id:{orig_h:192.168.0.51,orig_p:33773,resp_h:80.239.174.91,resp_p:443},proto:"tcp",service:null,duration:null,orig_bytes:null,resp_bytes:null,conn_state:"OTH",local_orig:null,local_resp:null,missed_bytes:0,history:"^d",orig_pkts:0,orig_ip_bytes:0,resp_pkts:1,resp_ip_bytes:1440,tunnel_parents:null,community_id:"1:wPP6HnEPl0F9QDVCQ+E0du2PUi8="} (3)
      ===
      {count:10 (uint64)} (=0)
