tag: services

script: |
  source services.sh
  zapi -service $ZQD_HOST new -k archivestore -thresh 20KiB testsp
  zapi -service $ZQD_HOST -s testsp post babble.zson >/dev/null
  echo ===
  zapi -service $ZQD_HOST -s testsp get -f text "count()"
  echo ===
  zapi -service $ZQD_HOST -s testsp get -f text "count()"
  echo ===
  curl $ZQD_HOST/metrics | grep archive_cache

inputs:
  - name: babble.zson
    source: ../../../../testdata/babble-sorted.zson
  - name: services.sh
    source: services.sh

outputs:
  - name: stdout
    data: |
      testsp: space created
      ===
      1000
      ===
      1000
      ===
      # HELP archive_cache_hits_total Number of hits for a cache lookup.
      # TYPE archive_cache_hits_total counter
      archive_cache_hits_total{kind="metadata"} 4
      # HELP archive_cache_misses_total Number of misses for a cache lookup.
      # TYPE archive_cache_misses_total counter
      archive_cache_misses_total{kind="metadata"} 2
