script: |
  source services.sh
  zapi -service $ZQD_HOST new test
  zapi -service $ZQD_HOST -s test postpath bad.zson | grep warning > warn.txt
  zapi -service $ZQD_HOST -s test get -f zson "count()" > out.zson

inputs:
  - name: services.sh
    source: ../services.sh
  - name: bad.zson
    data: |
      {ip:"1.1.1.1"}
      {ip:"1.1.1.2

outputs:
  - name: warn.txt
    regexp: |
      warning: .*
  - name: out.zson
    data: |
      {
          count: 1 (uint64)
      } (=0)
